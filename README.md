# Organization Directory API

## Описание

API обеспечивает **работу с организациями и зданиями**, позволяя:

- **Получать информацию о зданиях и организациях**;
- **Искать организации** по:
    - названию;
    - радиусу вокруг координат;
    - активности;
    - зданию, к которому они принадлежат;
- **Инициализировать данные** для разработки и тестирования.

Все эндпоинты (кроме healthcheck) защищены **API ключом**, проверка выполняется через заголовок `X-API-KEY`.

---

## Используемые технологии

- FastAPI — реализация REST API;
- dishka — внедрение зависимостей;
- pydantic — валидация входящих данных;
- PostgreSQL — хранение данных организаций, зданий и активностей;
- SQLAlchemy — orm + императивный маппинг, работа с базой данных;
- alembic - миграции
- Docker / Docker Compose — контейнеризация сервисов.

---

## Архитектура

### 1. **API (FastAPI)**

| Метод | Путь                                     | Описание                                             |
|-------|------------------------------------------|------------------------------------------------------|
| GET   | `/healthcheck`                           | Проверка состояния сервиса                           |
| POST  | `/data_router/`                          | Создание начальных данных                            |
| GET   | `/organizations/{organization_id}`       | Получение организации по ID                          |
| GET   | `/organizations/search/by-name`          | Поиск организации по имени                           |
| GET   | `/organizations/search/by-radius`        | Поиск организаций в радиусе                          |
| GET   | `/organizations/search/by-activity`      | Поиск организаций по активности                      |
| GET   | `/buildings/{building_id}/organizations` | Получение организаций, связанных с указанным зданием |

Все эндпоинты возвращают детализированные **сообщения об ошибках**, если:

- отсутствует или некорректен API ключ (`401`, `403`);
- не найдена организация, здание или активность (`404`).

### 2. **Use Cases**

- `CreateInitialDataUseCase` — инициализация тестовых данных (здания, организации, активности);
- `GetOrganizationByIdUseCase` — получение организации по ID;
- `SearchOrganizationByNameUseCase` — поиск организации по имени;
- `SearchOrganizationByRadiusUseCase` — поиск организаций вокруг координат;
- `SearchOrganizationByActivityUseCase` — поиск организаций по активности;
- `GetOrganizationsByBuildingUseCase` — получение организаций по зданию.

### 3. **Gateways**

- `OrganizationGateway` — работа с таблицей организаций;
- `BuildingGateway` — работа с таблицей зданий;
- `ActivityGateway` — работа с таблицей активностей;
- `InitialGateway` - создание тестовых данных

---

## Установка и запуск

1. Клонируйте репозиторий: `https://github.com/iMaanick/org-directory-api.git`
2. Создайте файл `.env` и заполните его как в примере `.example.env`
3. Соберите образы без кэша и поднимите сервисы в фоне:

```bash
docker-compose -f docker-compose.yaml build --no-cache
docker-compose -f docker-compose.yaml up -d
```
4. Перейдите в Swagger для тестирования эндпоинтов: ``http://localhost:8000/docs``
5. Создайте начальные данные через Swagger:
используйте метод POST по URL /data_router/ для генерации начальных организаций, зданий и активностей.
